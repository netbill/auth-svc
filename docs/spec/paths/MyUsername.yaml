patch:
  tags:
    - accounts
  summary: Update username
  description: >
    Updates the username of the authenticated account.

    **401 Unauthorized** is returned when credentials are invalid, the session is invalid,
    or the password is incorrect.
    **403 Forbidden** is returned when the initiator is blocked or username change is temporarily restricted.
    **409 Conflict** is returned when the requested username is already taken.
  security:
    - BearerAuth: [ ]
  requestBody:
    required: true
    content:
      application/json:
        schema:
          $ref: '../components/schemas/requests/UpdateUsername.yaml'
  responses:
    '200':
      description: Username successfully updated
      content:
        application/json:
          schema:
            $ref: '../components/schemas/responses/Account.yaml'

    '400':
      description: >
        Bad Request. Request body is invalid or the new username does not meet requirements.
        Check the `errors` array for details.
      content:
        application/json:
          schema:
            $ref: '../components/schemas/responses/Errors.yaml'
          examples:
            usernameNotAllowed:
              summary: username is not allowed
              value:
                errors:
                  - status: 400
                    title: Bad Request
                    code: VALIDATION_ERROR
                    detail: username is not allowed
                    source:
                      pointer: /data/attributes/new_username

    '401':
      description: >
        Unauthorized. Invalid credentials, invalid session, user not found, or invalid password.
        Check the `detail` field in the response for more information.
      content:
        application/json:
          schema:
            $ref: '../components/schemas/responses/Errors.yaml'
          examples:
            failedToGetUserFromContext:
              summary: failed to get user from context
              value:
                errors:
                  - status: 401
                    title: Unauthorized
                    code: UNAUTHORIZED
                    detail: failed to get user from context
            userNotFound:
              summary: failed to update password user not found
              value:
                errors:
                  - status: 401
                    title: Unauthorized
                    code: UNAUTHORIZED
                    detail: failed to update password user not found
            sessionInvalid:
              summary: initiator session is invalid
              value:
                errors:
                  - status: 401
                    title: Unauthorized
                    code: UNAUTHORIZED
                    detail: initiator session is invalid

    '409':
      description: >
        Conflict. The requested username is already taken.
        Check the `detail` field in the response for more information.
      content:
        application/json:
          schema:
            $ref: '../components/schemas/responses/Errors.yaml'
          examples:
            usernameAlreadyTaken:
              summary: user with this username already exists
              value:
                errors:
                  - status: 409
                    title: Conflict
                    code: CONFLICT
                    detail: user with this username already exists

    '500':
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '../components/schemas/responses/Errors.yaml'